"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[545],{34545:function(e,t,n){n.r(t),n.d(t,{default:function(){return x}});var a=n(80509),o=n(17354),l=n(38678),r=n(32951),c=n(66482),i=(0,c.Z)("div",{target:"eusnctq2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),u=(0,c.Z)("header",{target:"eusnctq1"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"}),s=((0,c.Z)("div",{target:"eusnctq0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"}),n(83564)),d=n(18667),f=n(9669),h=n.n(f),p=n(67294),m=n(5977),v=n(39249),g=n(8100),w=n(44593),y=n(91041);function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,o,l=[],r=!0,c=!1;try{for(n=n.call(e);!(r=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);r=!0);}catch(e){c=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var x=function(){var e,t,n=(0,m.UO)(),c=n.workspace,f=n.channel,k=b((0,r.Z)(c),1)[0],x=(0,g.ZP)("/api/users",s.Z).data,S=(0,g.ZP)("/api/workspaces/".concat(c,"/channels"),s.Z).data,_=null==S?void 0:S.find((function(e){return e.name===f})),C=(0,w.ZP)((function(e){return"/api/workspaces/".concat(c,"/channels/").concat(f,"/chats?perPage=").concat(20,"&page=").concat(e+1)}),s.Z,{onSuccess:function(e){1===(null==e?void 0:e.length)&&setTimeout((function(){var e;null===(e=M.current)||void 0===e||e.scrollToBottom()}),100)}}),Z=C.data,E=C.mutate,T=C.setSize,A=(0,g.ZP)(x?"/api/workspaces/".concat(c,"/channels/").concat(f,"/members"):null,s.Z).data,I=b((0,l.Z)(""),3),j=I[0],B=I[1],z=I[2],P=b((0,p.useState)(!1),2),U=P[0],D=P[1],M=(0,p.useRef)(null),O=b((0,p.useState)(!1),2),q=(O[0],O[1],0===(null==Z||null===(e=Z[0])||void 0===e?void 0:e.length)),N=q||Z&&(null===(t=Z[Z.length-1])||void 0===t?void 0:t.length)<20||!1,R=(0,p.useCallback)((function(){D(!1)}),[]),H=(0,p.useCallback)((function(e){if(e.preventDefault(),null!=j&&j.trim()&&Z&&_&&x){var t=j;E((function(e){var n;return null==e||e[0].unshift({id:((null===(n=Z[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,UserId:x.id,User:x,createdAt:new Date,ChannelId:_.id,Channel:_}),e}),!1).then((function(){var e;localStorage.setItem("".concat(c,"-").concat(f),(new Date).getTime().toString()),z(""),M.current&&(console.log("scrollToBottom!",null===(e=M.current)||void 0===e?void 0:e.getValues()),M.current.scrollToBottom())})),h().post("/api/workspaces/".concat(c,"/channels/").concat(f,"/chats"),{content:t}).catch(console.error)}}),[j,c,f,_,x,Z,E,z]),V=(0,p.useCallback)((function(e){e.Channel.name===f&&(e.content.startsWith("uploads\\")||e.content.startsWith("uploads/")||e.UserId!==(null==x?void 0:x.id))&&E((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){var e;M.current&&(M.current.getScrollHeight()<M.current.getClientHeight()+M.current.getScrollTop()+150?(console.log("scrollToBottom!",null===(e=M.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=M.current)||void 0===e||e.scrollToBottom()}),100)):v.Am.success("새 메시지가 도착했습니다.",{onClick:function(){var e;null===(e=M.current)||void 0===e||e.scrollToBottom()},closeOnClick:!0}))}))}),[f,x,E]);(0,p.useEffect)((function(){return null==k||k.on("message",V),function(){null==k||k.off("message",V)}}),[k,V]),(0,p.useEffect)((function(){localStorage.setItem("".concat(c,"-").concat(f),(new Date).getTime().toString())}),[c,f]);var W=(0,p.useCallback)((function(){D(!0)}),[]);if(S&&!_)return p.createElement(m.l_,{to:"/workspace/".concat(c,"/channel/일반")});var F=(0,d.Z)(Z?Z.flat().reverse():[]);return p.createElement(i,null,p.createElement(u,null,p.createElement("span",null,"#",f),p.createElement("div",{className:"header-right"},p.createElement("span",null,null==A?void 0:A.length),p.createElement("button",{onClick:W,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},p.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),p.createElement(o.Z,{scrollbarRef:M,isReachingEnd:N,isEmpty:q,chatSections:F,setSize:T}),p.createElement(a.Z,{onSubmitForm:H,chat:j,onChangeChat:B,placeholder:"Message #".concat(f)}),p.createElement(y.Z,{show:U,onCloseModal:R,setShowInviteChannelModal:D}))}}}]);